{% load static %}
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="{% static 'style.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
</head>
<body>

<h2>Paroli <br> <span>{{room}}</span></h2>

<div id="display">
<!-- 
 <div class="container darker">
  <b>ClaudioBrasileiro1990</b><p>Hey guys , lets do some uber drives !</p>
  <span class="time-left">20th, April 2021</span>
</div> 
 -->
</div>


<script>
    $(document).ready(function(){
        setInterval(function(){
            $.ajax({
                type: 'GET',
                url: "/getMessages/{{room}}/",
                success: function(response){
                    console.log(response);
                    $("#display").empty();
                    for (var key in response.messages) {
                        var message = response.messages[key];
                        var date = new Date(message.date);
                        var time = date.toLocaleTimeString(); // Get the formatted time

                        var temp = "<div class='container darker'><b>" + message.user + "</b><p>" + message.value + "</p><span class='time-left'>" + time + "</span></div>";
                        $("#display").append(temp);
                    }
                },
                error: function(response){
                    alert('An error occurred');
                }
            });
        }, 1000);
    });
</script>



<div class="container">
    <form id="post-form">
        {% csrf_token %}
        <input type="hidden" name="username" id="username" value="{{username}}"/>
        <input type="hidden" name="room_id" id="room_id" value="{{room_details.id}}"/>
        <input type="text" name="message" id="message" width="100px" />
        <input type="submit" value="Send">
    </form>
</div>


</body>

<script type="text/javascript">
    $(document).on('submit', '#post-form', function(e) {
        e.preventDefault();

        $.ajax({
            type: 'POST',
            url: '/send',
            data: {
                username: $('#username').val(),
                room_id: $('#room_id').val(),
                message: $('#message').val(),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),  // Correção aqui
            },
            success: function(data) {
                //alert(data);
            }
        });
        document.getElementById('message').value = '';
    });
</script>


</html>